(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"8b24":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",[a("q-splitter",{staticStyle:{height:"calc(100vh - 50px)"},attrs:{horizontal:""},scopedSlots:e._u([{key:"before",fn:function(){return[a("map-management")]},proxy:!0},{key:"separator",fn:function(){return[a("q-avatar",{attrs:{color:"grey","text-color":"white",size:"20px",icon:"drag_indicator"}})]},proxy:!0},{key:"after",fn:function(){return[a("q-tabs",{staticClass:"bg-primary text-white",attrs:{dense:""},model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},[a("q-tab",{attrs:{name:"tab-1",label:"Report Log"}},[a("q-badge",{attrs:{color:"red",floating:""}},[e._v(e._s(e.devReports.length))])],1),a("q-tab",{attrs:{name:"tab-2",label:"Driver Management"}},[a("q-badge",{attrs:{color:"red",floating:""}},[e._v(e._s(e.devFingers.length))])],1),a("q-tab",{attrs:{name:"tab-3",label:"Configuration"}})],1),a("q-tab-panels",{attrs:{swipeable:""},model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},[a("q-tab-panel",{attrs:{name:"tab-1"}},[a("report-log",{attrs:{"content-style":e.contentStyle}})],1),a("q-tab-panel",{attrs:{name:"tab-2"}},[a("driver-management",{attrs:{"content-style":e.contentStyle}})],1),a("q-tab-panel",{attrs:{name:"tab-3"}},[a("global-configuration",{attrs:{"content-style":e.contentStyle}})],1)],1)]},proxy:!0}]),model:{value:e.splitter,callback:function(t){e.splitter=t},expression:"splitter"}})],1)},n=[],r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{style:e.contentStyle},[0==e.devReports.length?a("q-banner",{scopedSlots:e._u([{key:"avatar",fn:function(){return[a("q-icon",{attrs:{name:"info"}})]},proxy:!0}],null,!1,1899737995)},[e._v("\n    No report yet\n  ")]):a("q-virtual-scroll",{attrs:{items:e.devReports,separator:""},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.item;return[a("q-item",{key:o.sendDatetime.val,attrs:{active:o.hex===e.report.hex,"active-class":"bg-primary text-white",clickable:"",dense:""},on:{click:function(t){return e.setReport(o)}}},[a("q-item-section",{attrs:{avatar:""}},[a("div",[a("q-chip",{staticClass:"q-ml-sm text-center",staticStyle:{width:"60px"},attrs:{color:"FULL"==o.frameID.out?"green":"light-green",dark:"",dense:"",square:""}},[e._v(e._s(o.frameID.out))]),a("q-chip",{attrs:{color:"primary",dark:"",dense:"",square:""}},[e._v(e._s(e.getDatetime(o.logDatetime)))])],1)]),a("q-item-section",[a("q-item-label",{staticClass:"ellipsis"},[e._v(e._s(o.hex))])],1)],1)]}}])}),a("q-page-sticky",{attrs:{position:"bottom-right",offset:[18,18]}},[a("q-btn",{attrs:{icon:e.followState?"lock":"lock_open",color:e.followState?"secondary":"grey",disable:0==e.devReports.length,"fab-mini":""},on:{click:function(t){e.followState=!e.followState}}},[a("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle"}},[e._v(e._s(e.followState?"Unfollow":"Follow"))])],1)],1)],1)},l=[],s=a("cfbf"),i=a("a7bc"),c=a("5662"),p=a("e4fd"),u=a("8d7e");const{useState:d,useGetters:b,useMutations:v}=Object(u["a"])("db");var m={props:{contentStyle:{type:String,required:!0}},setup(e){const{report:t}=d(["report"]),{devReports:a}=b(["devReports"]),{[i["k"]]:o}=v([i["k"]]),n=Object(u["a"])("common"),{follow:r}=n.useState(["follow"]),{[c["b"]]:l}=n.useMutations([c["b"]]),m=Object(p["computed"])({get:()=>r.value,set:e=>l(e)}),f=e=>s["a"].unix(e.val).format("HH:mm:ss");return{report:t,devReports:a,followState:m,setReport:o,getDatetime:f}}},f=m,g=a("2877"),q=a("54e1"),h=a("0016"),y=a("a12b"),O=a("66e5"),S=a("4074"),j=a("b047"),_=a("0170"),x=a("de5e"),w=a("9c40"),k=a("05c0"),D=a("eebe"),C=a.n(D),Q=Object(g["a"])(f,r,l,!1,null,null,null),R=Q.exports;C()(Q,"components",{QBanner:q["a"],QIcon:h["a"],QVirtualScroll:y["a"],QItem:O["a"],QItemSection:S["a"],QChip:j["a"],QItemLabel:_["a"],QPageSticky:x["a"],QBtn:w["a"],QTooltip:k["a"]});var F=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-splitter",{attrs:{value:e.streetView?50:100},scopedSlots:e._u([{key:"before",fn:function(){return[a("gmap-map",{staticClass:"fit",attrs:{center:e.center,zoom:e.zoom,options:e.options,"map-type-id":"roadmap"}},[e.position.valid?a("gmap-marker",{attrs:{position:e.position}}):e._e(),e.path.length>0?a("gmap-polyline",{ref:"polyline",attrs:{path:e.path}}):e._e()],1)]},proxy:!0},e.streetView?{key:"separator",fn:function(){return[a("q-avatar",{attrs:{color:"grey","text-color":"white",size:"20px",icon:"drag_indicator"}})]},proxy:!0}:null,e.streetView?{key:"after",fn:function(){return[a("gmap-street-view-panorama",{staticClass:"fit",attrs:{position:e.position,pov:e.pov,zoom:1},on:{pano_changed:e.updatePano,pov_changed:e.updatePov}})]},proxy:!0}:null],null,!0)},[a("q-resize-observer",{on:{resize:function(t){e.width=t.width}}})],1)},I=[],T=a("4082"),L=a.n(T),M=a("ded3"),z=a.n(M),N=a("9482"),$=a("af6a"),A=a("2ef0"),E=a("9944");const P=({lng:e,lat:t})=>{let{borderIndonesia:a}=N["a"].map;return e>a.lngMin&&e<a.lngMax&&t>a.latMin&&t<a.latMax},V=e=>{let t=z()(z()({},N["a"].map.centerIndonesia),{},{valid:!1});return"FULL"==Object(E["e"])(Object(A["get"])(e,"frameID.val"))&&(t.lat=Object(A["get"])(e,"gpsLatitude.val"),t.lng=Object(A["get"])(e,"gpsLongitude.val"),t.valid=P(t)),t},G=e=>"FULL"==Object(E["e"])(Object(A["get"])(e,"frameID.val"))?Object(A["get"])(e,"gpsHeading.val"):0,{useState:B,useGetters:H}=Object(u["a"])("db");var U={setup(e){const{report:t}=B(["report"]),{devDevice:a,devReports:o}=H(["devDevice","devReports"]),{centerIndonesia:n,zoom:r}=N["a"].map,l=Object(p["reactive"])({width:0,pov:null,pano:null,path:[],zoom:r,center:z()({},n),position:z()(z()({},n),{},{valid:!1}),options:{zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0,disableDefaultUi:!0}}),s=e=>l.pov=z()(z()({},e),{},{zoom:0}),i=e=>l.pano=e,c=e=>{let{valid:t}=e,a=L()(e,["valid"]);l.zoom=t?17:r,l.center=z()({},t?a:n),l.position=z()(z()({},a),{},{valid:t})},u=Object(p["computed"])((()=>l.position.valid&&l.width>500));return Object(p["watch"])((()=>a.value),((e,t)=>{if(Object(A["get"])(e,"unitID")!=Object(A["get"])(t,"unitID"))l.path=[];else{const t=Object(A["get"])(e,"lastFullReport"),a=V(t);a.valid&&l.path.push(a)}}),{lazy:!1,immediate:!0,deep:!0}),Object(p["watch"])((()=>t.value),((e,t)=>{const a="FULL"==Object(E["e"])(Object(A["get"])(e,"frameID.val")),n=a?e:Object($["c"])(e,o.value),r=V(n);c(r),(Object(A["get"])(e,"unitID.val")!=Object(A["get"])(t,"unitID.val")||r.valid)&&c(r),l.pov&&s(z()(z()({},l.pov),{},{heading:G(e)}))}),{lazy:!1,immediate:!0}),z()(z()({},Object(p["toRefs"])(l)),{},{streetView:u,updatePov:s,updatePano:i})}},J=U,Y=a("8562"),K=a("3980"),W=a("cb32"),X=Object(g["a"])(J,F,I,!1,null,null,null),Z=X.exports;C()(X,"components",{QSplitter:Y["a"],QResizeObserver:K["a"],QAvatar:W["a"]});var ee=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{style:e.contentStyle},[a("div",{staticClass:"text-subtitle2"},[e._v("Last fetch: "+e._s(e.getFingerTime()))]),0==e.devFingers.length?a("q-banner",{scopedSlots:e._u([{key:"avatar",fn:function(){return[a("q-icon",{attrs:{name:"info"}})]},proxy:!0}],null,!1,1899737995)},[e._v("\n    No finger driver yet\n  ")]):a("q-virtual-scroll",{attrs:{items:e.devFingers,separator:""},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.item;return[a("q-item",{key:o.fingerID,attrs:{dense:""}},[a("q-item-section",{attrs:{avatar:""}},[a("q-chip",{attrs:{color:"primary",dark:"",square:""}},[e._v(e._s(o.fingerID))])],1),a("q-item-section",[a("q-item-label",[e._v("Mr. "+e._s(e.name[o.fingerID-1]))])],1),a("q-item-section",{attrs:{side:""}},[a("q-btn",{attrs:{size:"sm",icon:"delete",outline:"",unelevated:"",round:""},on:{click:function(t){return e.remove(o)}}})],1)],1)]}}])}),a("q-page-sticky",{attrs:{position:"bottom-right",offset:[18,18]}},[a("q-fab",{attrs:{"external-label":"","vertical-actions-align":"right",color:"secondary",icon:"keyboard_arrow_left",direction:"left","label-position":"top",padding:"sm"},model:{value:e.fab,callback:function(t){e.fab=t},expression:"fab"}},[a("q-fab-action",{attrs:{disable:!e.devDevice,"label-position":"top",color:"primary",icon:"download",label:"Fetch","external-label":""},on:{click:e.fetch}}),a("q-fab-action",{attrs:{disable:!e.devDevice,"label-position":"top",color:"green",icon:"upload",label:"Add","external-label":""},on:{click:e.add}}),a("q-fab-action",{attrs:{disable:!e.devDevice,"label-position":"top",color:"orange",icon:"delete_forever",label:"Reset","external-label":""},on:{click:e.clear}})],1)],1)],1)},te=[],ae=a("b7fa3");const{useGetters:oe}=Object(u["a"])("db");var ne={props:{contentStyle:{type:String,required:!0}},setup(e){const t=inject("sendCommand"),{devFingers:a,devDevice:o}=oe(["devFingers","devDevice"]),n=Object(p["ref"])(["One","Two","Three","Four","Five"]),r=Object(p["ref"])(!1),l=()=>{let e=Object(A["get"])(o.value,"fingerTime");return e?s["a"].unix(e).format("DD-MM-YY HH:mm:ss"):"Unknown"},i=()=>t("FINGER_FETCH"),c=()=>t("FINGER_ADD"),u=({fingerID:e})=>Object(ae["a"])(`Are you sure to remove this fingerprint ${e} ?`).onOk((()=>t(`FINGER_DEL=${e}`))),d=()=>Object(ae["a"])("Are you sure to clear all fingerprints  ?").onOk((()=>t("FINGER_RST")));return{name:n,fab:r,devFingers:a,devDevice:o,getFingerTime:l,fetch:i,add:c,remove:u,clear:d}}},re=ne,le=a("c294"),se=a("72db"),ie=Object(g["a"])(re,ee,te,!1,null,null,null),ce=ie.exports;C()(ie,"components",{QBanner:q["a"],QIcon:h["a"],QVirtualScroll:y["a"],QItem:O["a"],QItemSection:S["a"],QChip:j["a"],QItemLabel:_["a"],QBtn:w["a"],QPageSticky:x["a"],QFab:le["a"],QFabAction:se["a"]});var pe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{style:e.contentStyle},[a("div",{staticClass:"row q-gutter-xs"},[a("div",{staticClass:"col-auto"},[a("q-btn",{attrs:{icon:"delete",label:"Reset DB",disable:0==e.devices.length},on:{click:function(t){return e.clearStore()}}})],1),e.$q.fullscreen.isCapable?a("div",{staticClass:"col-auto"},[a("q-btn",{attrs:{label:e.$q.fullscreen.isActive?"Full OFF":"Full ON",icon:e.$q.fullscreen.isActive?"fullscreen_exit":"fullscreen"},on:{click:function(t){return e.$q.fullscreen.toggle()}}})],1):e._e(),a("div",{staticClass:"col-auto"},[a("q-btn",{attrs:{icon:"alarm_on",label:"Calibrate",disable:0==e.devReports.length},on:{click:function(t){return e.calibrate()}}})],1),a("div",{staticClass:"col-auto"},[a("q-btn",{attrs:{icon:"stop",label:"Free command"},on:{click:function(t){return e.ignoreResponse()}}})],1),a("div",{staticClass:"col-auto"},[a("q-btn-dropdown",{attrs:{icon:"cloud_download",label:"Export"}},[a("q-list",[a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:e.reports.length>0},nativeOn:{click:function(t){return e.exportCSV(e.reports)}}},[a("q-item-section",[a("q-item-label",[e._v("CSV")])],1)],1),a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:e.reports.length>0},nativeOn:{click:function(t){return e.exportJSON(e.reports)}}},[a("q-item-section",[a("q-item-label",[e._v("JSON")])],1)],1)],1)],1)],1)]),a("div",{staticClass:"row q-gutter-xs q-mt-xs"},[a("div",{staticClass:"col-auto"},[a("q-uploader",{ref:"uploader",attrs:{factory:e.importData,accept:".json",label:"Import JSON","auto-upload":""}})],1)]),a("div",{staticClass:"row q-gutter-xs q-mt-xs"},[a("div",{staticClass:"col-auto"},[a("q-toggle",{attrs:{label:"Notification"},model:{value:e.notificationState,callback:function(t){e.notificationState=t},expression:"notificationState"}})],1)])])},ue=[],de=(a("ddb0"),a("13d5"),a("26e9"),a("fb6a"),a("e6cf"),a("f23f")),be=a("2e92");const ve=e=>e.map((e=>z()({},$["a"].reduce(((t,{field:a,no:o})=>z()(z()({},t),{},{[o]:e[a]?e[a].out:""})),{})))),me=()=>$["a"].reduce(((e,{title:t,unit:a})=>e.concat([t+(a?` (${a})`:"")])),[]),fe=e=>{const t=new de["ExportToCsv"]({fieldSeparator:",",quoteStrings:'"',decimalSeparator:".",showLabels:!0,showTitle:!1,title:"My Awesome CSV",useTextFile:!1,useBom:!0,useKeysAsHeaders:!1,headers:me()});t.generateCsv(ve(e))},ge=e=>e?e.map((({hex:e})=>e)):[],qe=e=>{const t=`tracking-${Object(s["a"])().format("YYMMDDHHmmss")}`,a=ge(e.slice().reverse()),o="json";Object(be["a"])({data:a,fileName:t,exportType:o})},he=e=>new Promise(((t,a)=>{e||a();let o=new FileReader;o.onload=e=>t(JSON.parse(e.target.result)),o.readAsText(e)}));var ye=a("6ad4");const{useState:Oe,useGetters:Se,useMutations:je,useActions:_e}=Object(u["a"])("db");var xe={props:{contentStyle:{type:String,required:!0}},setup(e){const t=Object(p["inject"])("sendCommand"),a=Object(p["inject"])("ignoreResponse"),{buffers:o,devices:n,command:r,reports:l}=Oe(["buffers","devices","command","reports"]),{devDevice:s,devReports:d}=Se(["devDevice","devReports"]),{[i["g"]]:b}=je([i["g"]]),{[ye["a"]]:v}=_e([ye["a"]]),m=Object(u["a"])("common"),{notification:f}=m.useState(["notification"]),{[c["c"]]:g}=m.useMutations([c["c"]]),q=Object(p["ref"])(null),h=Object(p["computed"])({get:()=>f.value,set:e=>g(e)}),y=()=>Object(ae["a"])("Are you sure to remove all data?").onOk((()=>b())),O=()=>{if(!s)return;let e=d.value.find((({frameID:e})=>"FULL"==Object(E["e"])(e.val)));if(!e)return;let a=Object(E["b"])(e);a&&(t(`REPORT_RTC=${a}`),Object(ae["c"])("Calibrating device time..","info"))},S=([e])=>{he(e).then((e=>v(e)))};return Object(p["watch"])((()=>o.value.length),(e=>0==e&&q.value.reset())),{uploader:q,devices:n,command:r,reports:l,devReports:d,notificationState:h,calibrate:O,clearStore:y,ignoreResponse:a,importData:S,exportJSON:qe,exportCSV:fe}}},we=xe,ke=a("f20b"),De=a("1c1c"),Ce=a("ee89"),Qe=a("9564"),Re=a("7f67"),Fe=Object(g["a"])(we,pe,ue,!1,null,null,null),Ie=Fe.exports;C()(Fe,"components",{QBtn:w["a"],QBtnDropdown:ke["a"],QList:De["a"],QItem:O["a"],QItemSection:S["a"],QItemLabel:_["a"],QUploader:Ce["a"],QToggle:Qe["a"]}),C()(Fe,"directives",{ClosePopup:Re["a"]});const{useGetters:Te}=Object(u["a"])("db");var Le={components:{MapManagement:Z,ReportLog:R,DriverManagement:ce,GlobalConfiguration:Ie},setup(e){const{devReports:t,devFingers:a}=Te(["devReports","devFingers"]),o=Object(p["ref"])("tab-1"),n=Object(p["ref"])(50),r=Object(p["computed"])((()=>`height: calc(100vh - ${n.value}vh - 95px)`));return{selectedTab:o,splitter:n,devReports:t,devFingers:a,contentStyle:r}}},Me=Le,ze=a("9989"),Ne=a("429b"),$e=a("7460"),Ae=a("58a81"),Ee=a("adad"),Pe=a("823b"),Ve=Object(g["a"])(Me,o,n,!1,null,null,null);t["default"]=Ve.exports;C()(Ve,"components",{QPage:ze["a"],QSplitter:Y["a"],QAvatar:W["a"],QTabs:Ne["a"],QTab:$e["a"],QBadge:Ae["a"],QTabPanels:Ee["a"],QTabPanel:Pe["a"]})}}]);